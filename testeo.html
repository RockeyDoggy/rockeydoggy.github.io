<!DOCTYPE html>
<html>
<head>
  <title>Twitch Chat Reader</title>
</head>
<body>
  <button id="login-button">Autenticar na Twitch</button>
  <div id="user-info"></div>
  <div id="chat"></div>

  <script>
    const clientId = 'wmvc2pcoaa2g2cno4ldyackeh3l8t7';
    const redirectUri = 'https://rockeydoggy.github.io/testes.html';
    const scope = 'user:read:email';

    const loginButton = document.getElementById('login-button');
    const userInfo = document.getElementById('user-info');
    const chatDisplay = document.getElementById('chat');

    loginButton.addEventListener('click', () => {
      window.location = `https://id.twitch.tv/oauth2/authorize?client_id=${clientId}&redirect_uri=${redirectUri}&response_type=token&scope=${scope}`;
    });

    const params = new URLSearchParams(window.location.hash.substring(1));
    const accessToken = params.get('access_token');

    if (accessToken) {
      fetch('https://api.twitch.tv/helix/users', {
        headers: {
          'Authorization': `Bearer ${accessToken}`,
          'Client-Id': clientId
        }
      })
      .then(response => response.json())
      .then(data => {
        const user = data.data[0];
        userInfo.innerHTML = `Nome de usu√°rio: ${user.login}<br/>Display Name: ${user.display_name}<br/>ID do Canal: ${user.id}`;
        
        // Connect to Twitch Chat
        const chatClient = new tmi.Client({
          connection: {
            secure: true,
            reconnect: true
          },
          channels: [user.login] // Replace with the desired channel
        });

        chatClient.connect().catch(console.error);

        chatClient.on('message', (channel, userstate, message, self) => {
          if (self) return;
          chatDisplay.innerHTML += `<p><strong>${userstate['display-name']}:</strong> ${message}</p>`;
        });
      });
    }
  </script>
  
  <script src="https://cdn.jsdelivr.net/npm/tmi.js"></script>
</body>
</html>
